{% extends 'base.html' %}

{% block title %}Event Schedule{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style1.css') }}">
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<style>
    .A {
        background-color: lightblue;
    }
    .B {
        background-color: lightgreen;
    }
    .C {
        background-color: lightcoral;
    }
</style>

<div class="container">
    <h1>Event Schedule</h1>
    <table>
        <thead>
            <tr>
                <th>Time</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Saturday</th>
                <th>Sunday</th>
            </tr>
        </thead>








        <tbody>
            {% for hour in hours %}
            <tr>
                <td>{{ hour }}</td>
                {% for day in days %}
                <td>
                    {% for event, event_type in schedule[day][hour] %}
                    <div class="event {{ event_type }}">
                        {{ event }}

                       
                        
                        {% for e in events %}
                        
                        {% if e.event == event and e.day == day and e.start_hour == hour %}
                        
                        <img src="{{ url_for('static', filename=e.qr_code_path) }}" alt="QR Code" width="50">
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endfor %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
        
        
        
        
        
       






    </table>
    
    <!-- Form to add events -->
    <form id="add-event-form" method="POST" >
        <label for="day">Day:</label>
        <select name="day" id="day">
            {% for day in days %}
            <option value="{{ day }}">{{ day }}</option>
            {% endfor %}
        </select>
        <label for="start_hour">Start Hour:</label>
        <select name="start_hour" id="start_hour">
            {% for hour in hours %}
            <option value="{{ hour }}">{{ hour }}</option>
            {% endfor %}
        </select>
        <label for="end_hour">End Hour:</label>
        <select name="end_hour" id="end_hour">
            {% for hour in hours %}
            <option value="{{ hour }}">{{ hour }}</option>
            {% endfor %}
        </select>
        <label for="event">Event:</label>
        <input type="text" id="event" name="event" required>
        <label for="event_type">Event Type:</label>
        <select name="event_type" id="event_type">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
        </select>
        <input type="submit" value="Add Event">
    </form>

    
</div>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const deleteButtons = document.querySelectorAll('.delete-event-btn');
    
        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const eventId = button.getAttribute('data-event-id');
    
                fetch('/delete_event', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `event_id=${eventId}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Event deleted successfully');
                        location.reload(); // Reload the page to update the schedule
                    } else {
                        alert('Failed to delete event: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the event.');
                });
            });
        });
    });
    </script>
    
{% endblock %}
